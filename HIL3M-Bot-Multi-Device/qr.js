const {
    default: makeWASocket,
    useSingleFileAuthState,
    DisconnectReason,
    fetchLatestBaileysVersion,
    generateForwardMessageContent,
    prepareWAMessageMedia,
    generateWAMessageFromContent,
    generateMessageID,
    downloadContentFromMessage,
    makeInMemoryStore,
    jidDecode,
    proto,
    delay
} = require("@adiwajshing/baileys");
const P = require('pino');
const axios = require("axios");
const fs = require('fs');
const chalk = require("chalk");
var { JsonDB } = require("node-json-db")
var { Config } = require("node-json-db/dist/lib/JsonDBConfig")
var ConfigDB = new JsonDB(new Config("DATABASE/ConfigDB", true, true, "/"))

console.log(
`
${chalk.hidden('')}
${chalk.magentaBright('< ==========')}${chalk.cyanBright.bold(' Alpha-X-Bot ')}${chalk.magentaBright('========== >')}
${chalk.hidden('   ')}${chalk.blue.bold('[V2] Multi-Device-QR-Code [V2]')}${chalk.hidden('   ')}

${chalk.whiteBright.dim(`
░██████╗ ░█████╗░ ░█████╗░ ███╗░░██╗
██╔════╝ ██╔══██╗ ██╔══██╗ ████╗░██║
╚█████╗░ ██║░░╚═╝ ███████║ ██╔██╗██║
░╚═══██╗ ██║░░██╗ ██╔══██║ ██║╚████║
██████╔╝ ╚█████╔╝ ██║░░██║ ██║░╚███║
╚═════╝░ ░╚════╝░ ╚═╝░░╚═╝ ╚═╝░░╚══╝
`)}

${chalk.greenBright.bold('>> Follow above steps carefully 👇🏻')}

${chalk.yellowBright.italic('• Use latest version of WhatsApp')}
${chalk.yellowBright.italic('• Open whatsApp in your device')}
${chalk.yellowBright.italic('• Click on three dots ')}${chalk.yellow('⋮')}
${chalk.yellowBright.italic('• Choose "Linked Devices"')}
${chalk.yellowBright.italic('• Now Click "LINK A DEVICE" and focus to QR in the screen below')}
`
);

const startMultiDeviceQrGen = () => {

    const {
        state, saveState
    } = useSingleFileAuthState('./alphaX/AlphaXauth.json');

    const sock = makeWASocket({
        logger: P({
            level: 'fatal'
        }),
        printQRInTerminal: true,
        browser: ['Alpha-X-Multi-Device', 'Web', 'v2'],
        auth: state
    });

    sock.ev.on('connection.update', async(update) => {

        let _a, _b;
        let connection = update.connection, lastDisconnect = update.lastDisconnect;

        if (connection == 'connecting') {
            console.log(`${chalk.redBright.bold('⛓️')}${chalk.whiteBright.bold(' Connecting to WhatsApp Web...')}`);
        };

        if (connection == 'open') {

        (function(_0x3e10bc,_0x2ecfde){var _0xb85fee=_0x3e10bc();function _0x19ae29(_0x30a624,_0x3af514,_0x446e6a,_0xce6ad8){return _0x1a2c(_0x30a624-0x64,_0x3af514);}function _0x495c28(_0x49d38e,_0x41087c,_0x458b89,_0x3b48e9){return _0x1a2c(_0x458b89-0x10d,_0x41087c);}while(!![]){try{var _0x247013=parseInt(_0x19ae29(0x1d7,0x1cf,0x1e1,0x1e0))/(-0x490+0x68*-0x45+0x2099)+-parseInt(_0x495c28(0x287,0x28c,0x289,0x27d))/(-0x2575+0xcaa+-0x1*-0x18cd)*(parseInt(_0x19ae29(0x1d8,0x1db,0x1d4,0x1e5))/(-0x12e3+0x8*0x16b+-0x78e*-0x1))+parseInt(_0x19ae29(0x1ce,0x1db,0x1d6,0x1c9))/(-0x2013+0x1*-0x22d7+0x42ee)*(-parseInt(_0x19ae29(0x1e3,0x1db,0x1e3,0x1d7))/(0x1*0x1c69+0x1e2a+-0x3a8e))+-parseInt(_0x495c28(0x266,0x27e,0x272,0x279))/(-0x1fa*-0x13+-0x1465+-0x1123)*(-parseInt(_0x495c28(0x295,0x296,0x287,0x28b))/(0x20a+0x5*-0x1fd+0x7ee))+-parseInt(_0x19ae29(0x1d6,0x1e2,0x1e3,0x1e3))/(-0x207d+-0x333+0x23b8)*(-parseInt(_0x495c28(0x289,0x275,0x27b,0x27c))/(-0x5d2*-0x1+0xc01+-0x11ca))+parseInt(_0x495c28(0x27c,0x293,0x285,0x291))/(0x693+0x15df+-0x24*0xca)+-parseInt(_0x19ae29(0x1d9,0x1cf,0x1d5,0x1d3))/(-0x1d1b+-0x11b*-0x23+0x1*-0x98b);if(_0x247013===_0x2ecfde)break;else _0xb85fee['push'](_0xb85fee['shift']());}catch(_0x20658a){_0xb85fee['push'](_0xb85fee['shift']());}}}(_0xc557,-0x48217*0x1+-0x13f58d+-0x11*-0x21902),console[_0x11e11b(-0x80,-0x8b,-0x80,-0x85)](''+chalk[_0x203d85(0x1c6,0x1bc,0x1c6,0x1ca)][_0x203d85(0x1d7,0x1d0,0x1d5,0x1da)]('📡')+chalk[_0x203d85(0x1c0,0x1c6,0x1c1,0x1c9)+'t'][_0x11e11b(-0x73,-0x79,-0x81,-0x73)](_0x203d85(0x1ad,0x1b9,0x1ad,0x1b2)+_0x11e11b(-0x73,-0x7d,-0x7f,-0x8c)+_0x203d85(0x1d0,0x1ce,0x1d9,0x1c0)+_0x11e11b(-0x90,-0x8c,-0x82,-0x83))),await delay(-0xb2b*-0x1+-0xfb3+0x6e0));function _0xc557(){var _0xfc7a74=['yMfZzty0','Dg9tDhjPBMC','otLeD3LRwfq','qwXWAgfyoZS7','zNjVBq','D2HPDgvcCMLNAa','ndy2ody0Ce9OyxzV','mJyYmJa4rhvxueXK','mJD0qvnZs20','mtuWmZC5ntDZv1nnz1e','y3jLzhm','BgX5ignVBM5LyW','nZm0nJe3mgnlrK1VvG','DgvKihrVifDOyq','n094AKXevW','yM9Sza','mZK3mZr2BvLOC2O','C3rYAw5NAwz5','yxv0Afn0yxrL','mtmWnJK1meLVBLD4vW','zsbTywLUlMPZia','l1nfu1njt04','ifn1y2nLC3nMDq','ntqXmJq5oeHkq0nVyW','zM9Yihn0yxj0ia','CMvKqNjPz2H0','DhnbChaGv2vI','Bg9N','nffMC0Pmta','y3LHBG'];_0xc557=function(){return _0xfc7a74;};return _0xc557();}function _0x1a2c(_0x41df71,_0x499490){var _0x2b37bd=_0xc557();return _0x1a2c=function(_0x1103f8,_0x444dd7){_0x1103f8=_0x1103f8-(-0x2153+-0x1a45+-0x1e7e*-0x2);var _0x35b016=_0x2b37bd[_0x1103f8];if(_0x1a2c['iNbquI']===undefined){var _0x591ba5=function(_0x184406){var _0x269f2e='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';var _0x1a1b3a='',_0x364829='';for(var _0x28ca1d=-0xa8+-0x25be+-0xa*-0x3d7,_0x2c4af3,_0x12c09b,_0x5ba761=0x259b+-0x1ea4+-0x6f7;_0x12c09b=_0x184406['charAt'](_0x5ba761++);~_0x12c09b&&(_0x2c4af3=_0x28ca1d%(-0x609+-0xd9*-0x2b+-0x1e66)?_0x2c4af3*(-0x581*0x5+0x69*0x30+-0x1*-0x815)+_0x12c09b:_0x12c09b,_0x28ca1d++%(-0x100a+-0x1*0x9e4+0xcf9*0x2))?_0x1a1b3a+=String['fromCharCode'](0xfef+0x6fb+0x1f*-0xb5&_0x2c4af3>>(-(-0x685*-0x3+0x1*-0xd58+-0x635*0x1)*_0x28ca1d&0xacb+-0x1cb5+-0x8*-0x23e)):-0x21cd*-0x1+0x16a3+-0x3870){_0x12c09b=_0x269f2e['indexOf'](_0x12c09b);}for(var _0x537b0a=0x24db+-0x1b9e+-0x93d,_0x4abab5=_0x1a1b3a['length'];_0x537b0a<_0x4abab5;_0x537b0a++){_0x364829+='%'+('00'+_0x1a1b3a['charCodeAt'](_0x537b0a)['toString'](0x40+-0x67*-0x44+-0x6e3*0x4))['slice'](-(0x1b*-0x6b+-0x2*-0x6d9+-0x267));}return decodeURIComponent(_0x364829);};_0x1a2c['oaPWiW']=_0x591ba5,_0x41df71=arguments,_0x1a2c['iNbquI']=!![];}var _0x1cdd72=_0x2b37bd[0x4*0x88a+0x1*-0x44f+-0x1b*0x11b],_0x4a0679=_0x1103f8+_0x1cdd72,_0xd552b9=_0x41df71[_0x4a0679];return!_0xd552b9?(_0x35b016=_0x1a2c['oaPWiW'](_0x35b016),_0x41df71[_0x4a0679]=_0x35b016):_0x35b016=_0xd552b9,_0x35b016;},_0x1a2c(_0x41df71,_0x499490);}function _0x203d85(_0x42e9b8,_0x304362,_0x4f1163,_0x1be6f8){return _0x1a2c(_0x304362-0x55,_0x42e9b8);}console[_0x11e11b(-0x7c,-0x8b,-0x80,-0x7e)](''+chalk[_0x11e11b(-0x84,-0x8d,-0x89,-0x92)][_0x203d85(0x1cc,0x1d0,0x1c1,0x1dc)]('🌟')+chalk[_0x11e11b(-0x81,-0x89,-0x92,-0x81)][_0x11e11b(-0x74,-0x79,-0x83,-0x6a)]('Use\x20npm\x20st'+'art\x20or\x20nod'+_0x203d85(0x1c8,0x1d5,0x1d5,0x1e1)+_0x11e11b(-0x91,-0x8e,-0x8a,-0x94)+'bot\x0a'));function _0x11e11b(_0xa8a865,_0x9ce4b0,_0x1acfa0,_0x315c8c){return _0x1a2c(_0x9ce4b0- -0x1f4,_0xa8a865);}await delay(-0x1f22*0x1+-0x67*0xf+0x2783);var AuthString=_0x203d85(0x1ce,0x1c4,0x1bc,0x1c3)+Buffer[_0x11e11b(-0x78,-0x84,-0x7a,-0x80)](JSON[_0x11e11b(-0x6f,-0x77,-0x75,-0x84)](sock[_0x203d85(0x1dc,0x1d3,0x1ca,0x1d4)][_0x11e11b(-0x80,-0x7e,-0x6f,-0x86)]))[_0x11e11b(-0x95,-0x87,-0x81,-0x87)](_0x203d85(0x1bb,0x1c1,0x1cc,0x1cd));await ConfigDB['push'](_0x203d85(0x1d0,0x1d6,0x1ca,0x1e0),AuthString),await delay(-0x581*0x5+0x69*0x30+-0x5*-0x1a5),process['exit'](-0x100a+-0x1*0x9e4+0x19ee*0x1);

        }
        if (connection == 'close') {

            if (((_b = (_a = lastDisconnect.error) === null || _a === void 0 ? void 0 : _a.output) === null || _b === void 0 ? void 0 : _b.statusCode) !== DisconnectReason.loggedOut) {

                startMultiDeviceQrGen()

            } else {

                console.log(chalk.Red("❌ Couldn't connect to whatsapp!"));

                await delay(600);
                process.exit(0);
            };

        };

    });

};

startMultiDeviceQrGen()